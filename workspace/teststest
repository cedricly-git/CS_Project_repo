import requests
import time

API_KEY = "1AhbgX6f-AVV6SPFX7-1q9v0HJ55kghAcuz3XE_4cms"
BASE_URL = "https://trefle.io/api/v1/species"

# 10 confirmed species slugs
species_slugs = [
    "quercus-rotundifolia", "urtica-dioica", "dactylis-glomerata", "plantago-lanceolata",
    "achillea-millefolium", "trifolium-repens", "holcus-lanatus", "ranunculus-repens",
    "quercus-robur", "festuca-rubra"
]

def fetch_images(slug):
    url = f"{BASE_URL}/{slug}?token={API_KEY}"
    response = requests.get(url)
    if response.status_code != 200:
        print(f"[ERROR] Failed to fetch {slug}: Status {response.status_code}")
        return []

    data = response.json().get("data", {})
    
    # Try to get the main image first
    main_image = data.get("image_url")
    
    # Then try to get from the images list
    images = data.get("images", [])
    urls = [img["image_url"] for img in images if isinstance(img, dict) and img.get("image_url")]

    # Include the main image if it's valid and not a duplicate
    if main_image and main_image not in urls:
        urls.insert(0, main_image)

    return urls

def main():
    for slug in species_slugs:
        print(f"\n[INFO] Fetching images for: {slug}")
        image_urls = fetch_images(slug)
        print(f"[INFO] Found {len(image_urls)} image(s)")
        if image_urls:
            for url in image_urls[:3]:  # print first 3 URLs only
                print(f" - {url}")
        time.sleep(1)  # avoid hitting API rate limits

if __name__ == "__main__":
    main()